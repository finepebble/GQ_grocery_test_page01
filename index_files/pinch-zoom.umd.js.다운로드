(function(c,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(c=typeof globalThis<"u"?globalThis:c||self,p(c.PinchZoom={}))})(this,function(c){"use strict";class p{constructor(t,i={}){this.scroller=null,this.scrollerStyle=null,this.utils=f,this._events={},this.elCurrent=null,this.maxScrollX=0,this.maxScrollY=0,this.touchesDistanceStart=0,this.startScale=1,this.originX=0,this.originY=0,this.enabled=!1,this.isInTransition=!1,this.initiated=null,this.moved=!1,this.distX=0,this.distY=0,this.directionLocked=0,this.startTime=0,this.isAnimating=!1,this.startX=0,this.startY=0,this.absStartX=0,this.absStartY=0,this.pointX=0,this.pointY=0,this.isUp=!1,this.startPointY=0,this.scrollerWidth=0,this.scrollerHeight=0,this.hasHorizontalScroll=!1,this.hasVerticalScroll=!1,this.wrapperWidth=0,this.wrapperHeight=0,this.endTime=0,this.resizeTimeout=null,this._transitionTime=e=>{e=e||0,this.scrollerStyle[this.utils.style.transitionDuration]=e+"ms",!e&&this.utils.isBadAndroid&&(this.scrollerStyle[this.utils.style.transitionDuration]="0.001s")},this._transitionTimingFunction=e=>{this.scrollerStyle[this.utils.style.transitionTimingFunction]=e};const s=window.innerHeight||document.body.clientHeight;if(this.options={zoom:!0,zoomMin:1,zoomMax:3,startZoom:1,startX:0,startY:0,scrollX:!0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!1,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0,useFixHeight:!1,useWindowScroll:!0,fixHeightValue:s,disablePointer:!0,deceleration:6e-4,bindToWrapper:!0},this.options={...this.options,...i},typeof t=="string"){const e=document.querySelector(t);if(!e)throw new Error(`Element not found: ${t}`);this.wrapper=e}else this.wrapper=t;for(let e=0;e<this.wrapper.children.length;e++)if(this.wrapper.children[e].tagName!=="SCRIPT"){this.scroller=this.wrapper.children[e];break}this.scroller&&(this.scrollerStyle=this.scroller.style),this.wrapper.style.overflow="hidden",this.options.useFixHeight&&(this.wrapper.style.height=`${this.options.fixHeightValue}px`),this.translateZ=this.options.HWCompositing&&this.utils.hasPerspective?" translateZ(0)":"",this.options.useTransition=this.utils.hasTransition&&this.options.useTransition,this.options.useTransform=this.utils.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY=this.options.eventPassthrough==="vertical"?!1:this.options.scrollY,this.options.scrollX=this.options.eventPassthrough=="horizontal"?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing=typeof this.options.bounceEasing=="string"?this.utils.ease[this.options.bounceEasing]||this.utils.ease.circular:this.options.bounceEasing,this.options.resizePolling=this.options.resizePolling||60,this.options.tap&&(this.options.tap="tap"),this.options.shrinkScrollbars=="scale"&&(this.options.useTransition=!1),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this.bZoomAction=!1,this.scale=Math.min(Math.max(this.options.startZoom,this.options.zoomMin),this.options.zoomMax),this.beforeScale=this.scale,this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY,0,0),this.enable(),this.elCurrent=null,this.bZoomStart=!1,this.bZoomEnd=!1,this.clientY=0}_init(){this._initEvents(),this.options.zoom&&this._initZoom()}destroy(){this._initEvents(!0),this._execEvent("destroy")}_transitionEnd(t){t instanceof TransitionEvent&&(t.target!==this.scroller||!this.isInTransition||(this._transitionTime(0),this.resetPosition(this.options.bounceTime||0)||(this.isInTransition=!1,this._execEvent("scrollEnd"))))}_start(t){if(this.utils.eventType[t.type]!==1&&"button"in t&&t.button!==0||!this.enabled||this.initiated&&this.utils.eventType[t.type]!==this.initiated)return;this.bZoomAction&&t.preventDefault();const i=t.touches?t.touches[0]:t;if(this.initiated=this.utils.eventType[t.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(0),this.startTime=this.utils.getTime(),this.options.useTransition&&this.isInTransition){this.isInTransition=!1;const s=this.getComputedPosition();this._translate(Math.round(s.x),Math.round(s.y)),this._execEvent("scrollEnd")}else!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd"));this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=i.pageX,this.pointY=i.pageY,this.clientY=i.clientY,this.startPointY=i.pageY,this.isUp=!1,this._execEvent("beforeScrollStart")}_move(t){if(!this.enabled||this.utils.eventType[t.type]!==this.initiated)return;const i=t.touches?t.touches[0]:t;let s=i.pageX-this.pointX,e=i.pageY-this.pointY;const n=this.utils.getTime();let h,o;this.pointX=i.pageX,this.pointY=i.pageY,this.distX+=s,this.distY+=e;const a=Math.abs(this.distX),l=Math.abs(this.distY);if(!this.directionLocked&&!this.options.freeScroll&&(a>l+this.options.directionLockThreshold?this.directionLocked="h":l>=a+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),this.directionLocked==="h"){if(this.options.eventPassthrough==="vertical")t.preventDefault();else if(this.options.eventPassthrough==="horizontal"){this.initiated=null;return}e=0}else if(this.directionLocked==="v"){if(this.options.eventPassthrough==="horizontal")t.preventDefault();else if(this.options.eventPassthrough==="vertical"){this.initiated=null;return}s=0}s=this.hasHorizontalScroll?s:0,e=this.hasVerticalScroll?e:0,h=this.x+s,o=this.y+e,!((o>0||o<this.maxScrollY)&&(o>0&&e>0||o<this.maxScrollY&&e<0))&&((h>0||h<this.maxScrollX)&&(h=this.options.bounce?this.x+s/3:h>0?0:this.maxScrollX),(o>0||o<this.maxScrollY)&&(o=this.options.bounce?this.y+e/3:o>0?0:this.maxScrollY),this.directionX=s>0?-1:s<0?1:0,this.directionY=e>0?-1:e<0?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this.isUp=Math.abs(o)>Math.abs(this.y),!(this.options.useWindowScroll&&this.x===h&&(this.isUp&&Math.abs(this.wrapperOffset.top)>document.body.scrollTop||!this.isUp&&Math.abs(this.wrapperOffset.top)+this.wrapperHeight<document.body.scrollTop+(window.innerHeight||document.body.clientHeight)))&&((this.x!==h||this.y!==o)&&t.preventDefault(),this._translate(h,o),n-this.startTime>300&&(this.startTime=n,this.startX=this.x,this.startY=this.y)))}_end(t){if(!(!this.enabled||this.utils.eventType[t.type]!==this.initiated)&&(this.options.preventDefault&&!this.utils.preventDefaultException(t.target,this.options.preventDefaultException)&&t.preventDefault(),this.isInTransition=!1,this.initiated=0,this.endTime=this.utils.getTime(),!this.resetPosition(this.options.bounceTime||0))){if(!this.moved){this.options.tap&&this.utils.tap(t,this.options.tap),this.options.click&&this.utils.click(t),this._execEvent("scrollCancel");return}if(this.options.momentum){const i=this.utils.getTime()-this.startTime,s=this.hasHorizontalScroll?this.utils.momentum(this.x,this.startX,i,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:this.x,duration:0},e=this.hasVerticalScroll?this.utils.momentum(this.y,this.startY,i,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:this.y,duration:0},n=s.destination,h=e.destination,o=Math.max(s.duration,e.duration);this.scrollTo(n,h,o);return}this._execEvent("scrollEnd")}}_resize(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.refresh()},this.options.resizePolling||60)}resetPosition(t=0){let i=this.x,s=this.y;return!this.hasHorizontalScroll||this.x>0?i=0:this.x<this.maxScrollX&&(i=this.maxScrollX),!this.hasVerticalScroll||this.y>0?s=0:this.y<this.maxScrollY&&(s=this.maxScrollY),i===this.x&&s===this.y?!1:(this.scrollTo(i,s,t,this.options.bounceEasing),!0)}disable(){this.enabled=!1}enable(){this.enabled=!0}refresh(t){var i,s;this.scale=t??this.scale,this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=Math.round((((i=this.scroller)==null?void 0:i.offsetWidth)||0)*this.scale),this.scrollerHeight=Math.round((((s=this.scroller)==null?void 0:s.offsetHeight)||0)*this.scale),this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=!!this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=!!this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=this.utils.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()}on(t,i){this._events[t]||(this._events[t]=[]),this._events[t].push(i)}off(t,i){if(!this._events[t])return;const s=this._events[t].indexOf(i);s>-1&&this._events[t].splice(s,1)}_execEvent(t,...i){if(!this._events[t])return;const s=this._events[t];if(!(!s||s.length===0))for(let e=0;e<s.length;e++)s[e].apply(this,i)}scrollBy(t,i,s,e){t=this.x+t,i=this.y+i,s=s||0,this.scrollTo(t,i,s,e)}scrollTo(t,i,s,e){e=e||this.utils.ease.circular,this.isInTransition=this.options.useTransition&&s>0,!s||this.options.useTransition&&e.style?(this._transitionTimingFunction(e.style),this._transitionTime(s),this._translate(t,i)):this._animate(t,i,s,e.fn)}scrollToElement(t,i,s,e,n){var a;const h=typeof t=="string"?(a=this.scroller)==null?void 0:a.querySelector(t):t;if(!h)return;const o=this.utils.offset(h);o.left-=this.wrapperOffset.left,o.top-=this.wrapperOffset.top,s===!0&&(s=Math.round(h.offsetWidth/2-this.wrapper.offsetWidth/2)),e===!0&&(e=Math.round(h.offsetHeight/2-this.wrapper.offsetHeight/2)),o.left-=s||0,o.top-=e||0,o.left=o.left>0?0:o.left<this.maxScrollX?this.maxScrollX:o.left,o.top=o.top>0?0:o.top<this.maxScrollY?this.maxScrollY:o.top,(i==null||i==="auto")&&(i=Math.max(Math.abs(this.x-o.left),Math.abs(this.y-o.top))),this.scrollTo(o.left,o.top,i,n)}_translate(t,i){if(this.options.useTransform){if((!this.bZoomStart&&this.beforeScale>1||this.bZoomStart&&this.bZoomEnd)&&this.scale===1&&this.beforeScale!==this.scale&&this.elCurrent!==null){const s=this.utils.offset(this.elCurrent),n=Math.abs(s.top)-((window.innerHeight||document.body.clientHeight)/2-this.elCurrent.offsetHeight/2);window.scrollTo(0,n),this.bZoomStart=!1,this.bZoomEnd=!1}this.beforeScale=this.scale,this.scrollerStyle&&(this.scrollerStyle[this.utils.style.transform]=`translate(${t}px, ${i}px) scale(${this.scale}) ${this.translateZ}`)}else t=Math.round(t),i=Math.round(i),this.scrollerStyle&&(this.scrollerStyle.left=`${t}px`,this.scrollerStyle.top=`${i}px`);this.x=t,this.y=i}_initEvents(t=!1){const i=t?this.utils.removeEvent:this.utils.addEvent,s=this.wrapper;this.utils.hasPointer&&!this.options.disablePointer&&(i(this.wrapper,this.utils.prefixPointerEvent("down"),this.handleEvent.bind(this)),i(s,this.utils.prefixPointerEvent("move"),this.handleEvent.bind(this)),i(s,this.utils.prefixPointerEvent("cancel"),this.handleEvent.bind(this)),i(s,this.utils.prefixPointerEvent("up"),this.handleEvent.bind(this))),this.utils.hasTouch&&!this.options.disableTouch&&(i(this.wrapper,"touchstart",this.handleEvent.bind(this)),i(s,"touchmove",this.handleEvent.bind(this)),i(s,"touchcancel",this.handleEvent.bind(this)),i(s,"touchend",this.handleEvent.bind(this))),["transitionend","webkitTransitionEnd","oTransitionEnd","MSTransitionEnd"].forEach(n=>{i(this.scroller,n,this.handleEvent.bind(this))})}isZoomUp(){return this.scale>1}getComputedPosition(){if(!this.scroller)throw new Error("Scroller element가 존재하지 않습니다.");const t=window.getComputedStyle(this.scroller);let i=0,s=0;if(this.options.useTransform&&this.utils.style.transform){const e=t[this.utils.style.transform];if(e&&e!=="none"){const n=e.split(")")[0].split(", ");i=+(n[12]||n[4])||0,s=+(n[13]||n[5])||0}}else i=parseFloat(t.left||"0"),s=parseFloat(t.top||"0");return{x:i,y:s}}_initZoom(){this.scrollerStyle[this.utils.style.transformOrigin]="0 0"}_zoomStart(t){if(!t.touches||t.touches.length<2)throw new Error("Zoom을 위한 터치가 2개 이상 필요합니다.");const i=Math.abs(t.touches[0].pageX-t.touches[1].pageX),s=Math.abs(t.touches[0].pageY-t.touches[1].pageY);this.touchesDistanceStart=Math.sqrt(i*i+s*s),this.startScale=this.scale,this.originX=(t.touches[0].pageX+t.touches[1].pageX)/2+this.wrapperOffset.left-this.x,this.originY=(t.touches[0].pageY+t.touches[1].pageY)/2+this.wrapperOffset.top-this.y,this._execEvent("zoomStart")}_zoom(t){if(!this.enabled||f.eventType[t.type]!==this.initiated)return;this.options.preventDefault&&t.preventDefault();const i=Math.abs(t.touches[0].pageX-t.touches[1].pageX),s=Math.abs(t.touches[0].pageY-t.touches[1].pageY),e=Math.sqrt(i*i+s*s);let n=1/this.touchesDistanceStart*e*this.startScale;this.scaled=!0,n<this.options.zoomMin?n=.5*this.options.zoomMin*Math.pow(2,n/this.options.zoomMin):n>this.options.zoomMax&&(n=2*this.options.zoomMax*Math.pow(.5,this.options.zoomMax/n));const h=n/this.startScale,o=this.originX-this.originX*h+this.startX,a=this.originY-this.originY*h+this.startY;this.scale=n,this.scrollTo(o,a,0)}_zoomEnd(t){if(!this.enabled||this.utils.eventType[t.type]!==this.initiated)return;let i,s;this.isInTransition=!1,this.initiated=0,this.scale>(this.options.zoomMax||3)?this.scale=this.options.zoomMax||3:this.scale<(this.options.zoomMin||1)&&(this.scale=this.options.zoomMin||1),this.refresh();const e=this.scale/this.startScale;i=this.originX-this.originX*e+this.startX,s=this.originY-this.originY*e+this.startY,i>0?i=0:i<this.maxScrollX&&(i=this.maxScrollX),s>0?s=0:s<this.maxScrollY&&(s=this.maxScrollY),(this.x!==i||this.y!==s)&&this.scrollTo(i,s,this.options.bounceTime||0),this.scaled=!1,this._execEvent("zoomEnd")}zoom(t,i,s,e){if(t<(this.options.zoomMin||1)?t=this.options.zoomMin||1:t>(this.options.zoomMax||3)&&(t=this.options.zoomMax||3),t===this.scale)return;const n=t/this.scale;i=i===void 0?this.wrapperWidth/2:i,s=s===void 0?this.wrapperHeight/2:s,e=e===void 0?300:e,i=i+this.wrapperOffset.left-this.x,s=s+this.wrapperOffset.top-this.y,i=i-i*n+this.x,s=s-s*n+this.y,this.scale=t,this.refresh(),i>0?i=0:i<this.maxScrollX&&(i=this.maxScrollX),s>0?s=0:s<this.maxScrollY&&(s=this.maxScrollY),this.scrollTo(i,s,e)}_animate(t,i,s,e){const n=this.x,h=this.y,o=this.utils.getTime(),a=o+s,l=()=>{const u=this.utils.getTime();if(u>=a){this.isAnimating=!1,this._translate(t,i),this.resetPosition(this.options.bounceTime)||this._execEvent("scrollEnd");return}const m=(u-o)/s,d=e(m),g=(t-n)*d+n,v=(i-h)*d+h;this._translate(g,v),this.isAnimating&&requestAnimationFrame(l)};this.isAnimating=!0,l()}handleEvent(t){switch(t.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this.elCurrent=t.target,this.bZoomStart=!1,this.bZoomEnd=!1,this.bZoomAction=!!this.options.zoom&&"touches"in t&&t.touches.length>1,this._start(t),this.options.zoom&&"touches"in t&&t.touches.length>1&&(this.bZoomStart=!0,this._zoomStart(t));break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":if(this.options.zoom&&"touches"in t&&t.touches[1]){this.bZoomStart=!0,this._zoom(t);return}this._move(t);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":if(this.scaled){this.bZoomStart=!0,this.bZoomEnd=!0,this._zoomEnd(t);return}this._end(t);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(t);break}}}const r=class r{static _prefixStyle(t){return r._vendor?r._vendor+t.charAt(0).toUpperCase()+t.slice(1):t}static getTime(){return Date.now?Date.now():new Date().getTime()}static extend(t,i){for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}static addEvent(t,i,s,e=!1){t.addEventListener(i,s,e)}static removeEvent(t,i,s,e=!1){t.removeEventListener(i,s,e)}static prefixPointerEvent(t){return window.MSPointerEvent?"MSPointer"+t.charAt(9).toUpperCase()+t.slice(10):t}static momentum(t,i,s,e,n,h=6e-4){let o=t-i;const a=Math.abs(o)/s;let l=t+a*a/(2*h)*(o<0?-1:1),u=a/h;return l<e?(l=n?e-n/2.5*(a/8):e,o=Math.abs(l-t),u=o/a):l>0&&(l=n?n/2.5*(a/8):0,o=Math.abs(t)+l,u=o/a),{destination:Math.round(l),duration:u}}static hasClass(t,i){return new RegExp("(^|\\s)"+i+"(\\s|$)").test(t.className)}static addClass(t,i){if(r.hasClass(t,i))return;const s=t.className.split(" ");s.push(i),t.className=s.join(" ")}static removeClass(t,i){if(!r.hasClass(t,i))return;const s=new RegExp("(^|\\s)"+i+"(\\s|$)","g");t.className=t.className.replace(s," ")}static offset(t){let i=-t.offsetLeft,s=-t.offsetTop;for(;t=t.offsetParent;)i-=t.offsetLeft,s-=t.offsetTop;return{left:i,top:s}}static preventDefaultException(t,i){for(const s in i)if(i[s].test(t[s]))return!0;return!1}static tap(t,i){const s=new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:{pageX:t.pageX||t.pageX,pageY:t.pageY||t.pageY}});t.target.dispatchEvent(s)}static click(t){const i=t.target;if(!/(SELECT|INPUT|TEXTAREA)/i.test(i.tagName)){const s=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:t.view,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,button:0,relatedTarget:null});s._constructed=!0,i.dispatchEvent(s)}}};r._elementStyle=document.createElement("div").style,r._vendor=function(){const t=["t","webkitT","MozT","msT","OT"];for(const i of t)if(i+"ransform"in r._elementStyle)return i.slice(0,-1);return""}(),r.transform=r._prefixStyle("transform"),r.hasTransform=r.transform!=="false",r.hasPerspective=r._prefixStyle("perspective")in r._elementStyle,r.hasTouch="ontouchstart"in window,r.hasPointer=!!window.PointerEvent||!!window.MSPointerEvent,r.hasTransition=r._prefixStyle("transition")in r._elementStyle,r.isBadAndroid=/Android /.test(window.navigator.userAgent)&&!/Chrome\/\d/.test(window.navigator.userAgent),r.style={transform:r.transform,transitionTimingFunction:r._prefixStyle("transitionTimingFunction"),transitionDuration:r._prefixStyle("transitionDuration"),transitionDelay:r._prefixStyle("transitionDelay"),transformOrigin:r._prefixStyle("transformOrigin")},r.eventType={touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3},r.ease={quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn(t){return t*(2-t)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn(t){return Math.sqrt(1- --t*t)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn(t){return(t=t-1)*t*(5*t+4)+1}},bounce:{style:"",fn(t){return(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}},elastic:{style:"",fn(t){return t===0?0:t===1?1:.4*Math.pow(2,-10*t)*Math.sin((t-.22/4)*(2*Math.PI)/.22)+1}}};let f=r;typeof window<"u"&&(window.PinchZoom=p),c.PinchZoom=p,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
